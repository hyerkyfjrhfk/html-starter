<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemini 1.5 Flash Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-jxGk9h..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
body {
  margin: 0;
  font-family: Arial,sans-serif;
  background: #0f172a;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.chat-container {
  width: 400px;
  height: 600px;
  background: #1c1c1c;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
}

.messages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.message {
  padding: 10px 15px;
  border-radius: 8px;
  max-width: 80%;
  word-wrap: break-word;
}

.message.user {
  background: #4a90e2;
  color: white;
  align-self: flex-end;
}

.message.assistant {
  background: #333;
  color: #f1f1f1;
  align-self: flex-start;
}

.input-area {
  display: flex;
  border-top: 1px solid #444;
}

#prompt {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 0;
  font-size: 14px;
  color: white;
  background: #222;
  resize: none;
}

#prompt:focus {
  outline: none;
}

#send {
  width: 80px;
  background: #4a90e2;
  border: none;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

#send:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>
</head>
<body>

<div class="chat-container">
  <div class="messages" id="messages"></div>
  <div class="input-area">
    <textarea id="prompt" rows="1" placeholder="Type your message..."></textarea>
    <button id="send">Send</button>
  </div>
</div>

<script>
const API_KEY = "AIzaSyCPXBI8k9TcAay0A2G7D9-JF4JYDw4DzY4";
const MODEL = "gemini-1.5-flash";

const messagesDiv = document.getElementById("messages");
const promptInput = document.getElementById("prompt");
const sendButton = document.getElementById("send");

const conversation = [];

function addMessage(role, text) {
  const div = document.createElement("div");
  div.className = "message " + role;
  div.textContent = text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

async function sendMessage() {
  const text = promptInput.value.trim();
  if (!text) return;

  addMessage("user", text);
  conversation.push({ role: "user", parts: [{ text }] });

  promptInput.value = "";
  promptInput.disabled = true;
  sendButton.disabled = true;

  const loading = document.createElement("div");
  loading.className = "message assistant";
  loading.textContent = "Typing...";
  messagesDiv.appendChild(loading);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;

  try {
    const res = await fetch(
      `https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ contents: conversation })
      }
    );

    const data = await res.json();
    messagesDiv.removeChild(loading);

    const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text;

    if (reply) {
      addMessage("assistant", reply);
      conversation.push({ role: "model", parts: [{ text: reply }] });
    } else if (data?.error?.message) {
      addMessage("assistant", "Error: " + data.error.message);
    } else {
      addMessage("assistant", "No response returned.");
    }

  } catch (err) {
    messagesDiv.removeChild(loading);
    addMessage("assistant", "Request failed: " + err.message);
  } finally {
    promptInput.disabled = false;
    sendButton.disabled = false;
    promptInput.focus();
  }
}

sendButton.addEventListener("click", sendMessage);
promptInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

promptInput.focus();
</script>

</body>
</html>
