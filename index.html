<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chat</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(to bottom right, #1a1a2e, #0f0f1e, #000);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chat-container {
    width: 100%;
    max-width: 900px;
    height: calc(100vh - 40px);
    background: #1e293b;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid #334155;
}

.messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.message {
    display: flex;
    gap: 12px;
}

.message.user {
    flex-direction: row-reverse;
}

.avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.message.user .avatar {
    background: linear-gradient(#3b82f6, #06b6d4);
}

.message.assistant .avatar {
    background: linear-gradient(#a855f7, #ec4899);
}

.message-content {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 16px;
    font-size: 14px;
    line-height: 1.6;
}

.message.user .message-content {
    background: linear-gradient(#3b82f6, #06b6d4);
    color: #fff;
}

.message.assistant .message-content {
    background: #334155;
    color: #f1f5f9;
}

.input-area {
    border-top: 1px solid #334155;
    background: #0f172a;
    padding: 16px;
}

.input-wrapper {
    display: flex;
    gap: 8px;
}

#messageInput {
    flex: 1;
    padding: 12px 16px;
    background: #334155;
    border: 1px solid #475569;
    border-radius: 12px;
    color: white;
}

#sendButton {
    padding: 12px 24px;
    background: linear-gradient(#a855f7, #ec4899);
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
}
</style>
</head>

<body>
<div class="chat-container">
    <div class="messages" id="messages"></div>

    <div class="input-area">
        <div class="input-wrapper">
            <input id="messageInput" placeholder="Type your message..." autocomplete="off">
            <button id="sendButton">Send</button>
        </div>
    </div>
</div>

<script>
const GEMINI_API_KEY = "AIzaSyCPXBI8k9TcAay0A2G7D9-JF4JYDw4DzY4";

const messagesDiv = document.getElementById("messages");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendButton");

const conversationHistory = [];

// Initial assistant message (NOW INCLUDED)
addMessage("assistant", "Hello! I'm your AI assistant powered by Gemini.");
conversationHistory.push({
    role: "model",
    parts: [{ text: "Hello! I'm your AI assistant powered by Gemini." }]
});

function addMessage(role, text) {
    const msg = document.createElement("div");
    msg.className = `message ${role}`;
    msg.innerHTML = `
        <div class="avatar"></div>
        <div class="message-content"></div>
    `;
    msg.querySelector(".message-content").textContent = text;
    messagesDiv.appendChild(msg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    input.value = "";
    addMessage("user", text);

    conversationHistory.push({
        role: "user",
        parts: [{ text }]
    });

    try {
        const res = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`,
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: conversationHistory })
            }
        );

        const data = await res.json();

        if (data.error) {
            addMessage("assistant", data.error.message);
            return;
        }

        const reply = data.candidates[0].content.parts[0].text;
        addMessage("assistant", reply);

        conversationHistory.push({
            role: "model",
            parts: [{ text: reply }]
        });

    } catch (e) {
        addMessage("assistant", "Request failed.");
        console.error(e);
    }
}

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
});
</script>
</body>
</html>
